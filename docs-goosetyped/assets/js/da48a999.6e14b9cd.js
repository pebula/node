"use strict";(self.webpackChunknode=self.webpackChunknode||[]).push([[5402],{6208:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var s=t(4848),o=t(8453),r=t(6640);const i={id:"columns",title:"Columns",sidebar_label:"2. Columns"},a=void 0,l={id:"basics/columns",title:"Columns",description:"Columns are the building blocks of every model.",source:"@site/docs/basics/columns.md",sourceDirName:"basics",slug:"/basics/columns",permalink:"/node/docs-goosetyped/docs/basics/columns",draft:!1,unlisted:!1,editUrl:"https://github.com/pebula/node/tree/main/apps/docs/goosetyped/docs/docs/basics/columns.md",tags:[],version:"current",frontMatter:{id:"columns",title:"Columns",sidebar_label:"2. Columns"},sidebar:"sidebar",previous:{title:"1. Metadata",permalink:"/node/docs-goosetyped/docs/basics/metadata"},next:{title:"3. Documents & SubDocuments",permalink:"/node/docs-goosetyped/docs/basics/documents-and-sub-documents"}},c={},d=[{value:"Column Options (metadata)",id:"column-options-metadata",level:2},{value:"Column Type",id:"column-type",level:2},{value:"Explicit type definition",id:"explicit-type-definition",level:3},{value:"Array",id:"array",level:4},{value:"Map",id:"map",level:4},{value:"Circular or Undefined",id:"circular-or-undefined",level:4}];function u(e){const n={admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Columns are the building blocks of every model."}),"\n",(0,s.jsx)(n.p,{children:"Each column has a type and optionally additional metadata used to describe a behavior or property of that column."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { GtDocument, GtModel } from '@pebula/goosetyped';\n\n@GtDocument()\nexport class Customer extends GtModel() {\n  @GtColumn()\n  name: string;\n\n  @GtColumn()\n  age: number;\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"column-options-metadata",children:"Column Options (metadata)"}),"\n",(0,s.jsx)(n.p,{children:"We can add additional metadata to columns:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { GtDocument, GtModel } from '@pebula/goosetyped';\n\n@GtDocument()\nexport class Customer extends GtModel() {\n  @GtColumn({\n    required: true,\n  })\n  name: string;\n\n  @GtColumn({\n    validate: value => value > 0,\n  })\n  age: number;\n\n  @GtColumn({\n    enum: ['male', 'female', 'other'],\n    default: 'other'\n  })\n  gender: 'male' | 'female' | 'other';\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can review all of the metadata options in the API docs for ",(0,s.jsx)(r.ol,{type:"interface",symbol:"GtColumnMetadataArgs",children:"GtColumnMetadataArgs<T>"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"column-type",children:"Column Type"}),"\n",(0,s.jsxs)(n.p,{children:["TypeScript emits the type used for every column so ",(0,s.jsx)(n.strong,{children:"GooseType"})," can use that to automatically define the proper type with mongoose."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export class Customer {\n  @GtColumn()\n  age: number;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In the example above ",(0,s.jsx)(n.strong,{children:"GooseType"})," will identify that the type is a number and will use ",(0,s.jsx)(n.code,{children:"mongoose.Schema.Types.Number"})," as the type for the column."]}),"\n",(0,s.jsx)(n.h3,{id:"explicit-type-definition",children:"Explicit type definition"}),"\n",(0,s.jsx)(n.p,{children:"There are some scenarios in which typescript's type system is not able to provide a type definition and an explicit type definition is required."}),"\n",(0,s.jsx)(n.p,{children:"This usually happen when:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Generics is used to define the type (e.g. ",(0,s.jsx)(n.code,{children:"Array<string>"}),", ",(0,s.jsx)(n.code,{children:"Map<number>"}),", etc...)"]}),"\n",(0,s.jsx)(n.li,{children:"The type is unknown at the time it is defined (usually due to cyclic reference)"}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"GooseType"})," will throw an error when these scenarios occur and are not handled."]})}),"\n",(0,s.jsx)(n.p,{children:"Additionally, it might be that would want to customize the type defined."}),"\n",(0,s.jsxs)(n.p,{children:["To define a custom type we use ",(0,s.jsx)(r.ol,{type:"interface",symbol:"GtColumnMetadataArgs",hash:"type",children:"GtColumnMetadataArgs.type"}),"\nwhich accepts one of:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Schema"}),"\n",(0,s.jsxs)(n.li,{children:["typeof SchemaType (e.g ",(0,s.jsx)(n.code,{children:"mongoose.Schema.Types.Number"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["A function that returns a ",(0,s.jsx)(n.strong,{children:"GooseTyped"})," model or resource (the classes of a document or sub-document)."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"We will not go into depth on the first two options, they are straight forward and we recommend not to use them\nunless there is really no solution to your problem."}),"\n",(0,s.jsx)(n.p,{children:"The last option is nothing but a simple arrow function that returns the type for this column, let's review some examples:"}),"\n",(0,s.jsx)(n.h4,{id:"array",children:"Array"}),"\n",(0,s.jsx)(n.p,{children:"This covers the 1st scenario which TS can not resolve the type for us:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export class Person {\n  @GtColumn({\n    type: () => String,\n  })\n  friends: string[];\n\n  @GtColumn({\n    type: () => Date,\n  })\n  importantDates: Array<Date>;\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["We return the actual generic type, ",(0,s.jsx)(n.code,{children:"String"})," and not ",(0,s.jsx)(n.code,{children:"Array<string>"}),". TypeScript already resolves the type to Array we only need the internal type."]})}),"\n",(0,s.jsx)(n.h4,{id:"map",children:"Map"}),"\n",(0,s.jsxs)(n.p,{children:["Again, same as ",(0,s.jsx)(n.code,{children:"Array"})," above, TS can not resolve the subject type of the Map, it will only resolve ",(0,s.jsx)(n.code,{children:"Map"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export class Person {\n  @GtColumn({\n    type: () => Number,\n  })\n  map: Map<number>;\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"circular-or-undefined",children:"Circular or Undefined"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// module: person.ts\nexport class Person {\n\n  @GtColumn({\n    type: () => Address,\n  })\n  address: Address;\n}\n\n// module: address.ts\nexport class Address {\n\n  @GtColumn({\n    type: () => Person,\n  })\n  resident: Person;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["At the time when the class is defined both modules (person & address) refer to each other.",(0,s.jsx)(n.br,{}),"\n","This means that the type will be undefined and will get populated later once both classes are exported."]}),"\n",(0,s.jsx)(n.p,{children:"TypeScript does not account for that and will mark the type for the property as undefined.\nTo solve this we use the function that returns the type. We will resolve the type after both classes are resolved so we will get the proper value."}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Circular reference types requires deffered model initialization described in the advanced section."})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},6640:(e,n,t)=>{t.d(n,{ol:()=>l,z7:()=>h,jd:()=>m,pX:()=>y});var s=t(6540),o=t(6025),r=t(4586),i=t(8774),a=t(4848);function l(e){var n=(0,r.A)(),t=e.symbol;return(0,a.jsx)(i.A,{to:(0,o.A)(""+n.siteConfig.customFields.apiDocPrefix+t.toLowerCase()),children:e.children||t})}var c=t(5293),d=t(1765);const u={plain:{color:"#f8f8f2",backgroundColor:"#272822"},styles:[{types:["comment"],style:{color:"rgb(136, 132, 111)"}},{types:["string","changed"],style:{color:"rgb(230, 219, 116)"}},{types:["punctuation","tag","deleted"],style:{color:"rgb(249, 38, 114)"}},{types:["number","builtin"],style:{color:"rgb(174, 129, 255)"}},{types:["variable"],style:{color:"rgb(248, 248, 242)"}},{types:["function","attr-name","inserted"],style:{color:"rgb(166, 226, 46)"}}]},p={codeSnippet:"codeSnippet_KFiO"};function h(e){var n=(0,r.A)().siteConfig.themeConfig.prism||{},t=(0,s.useState)(!1),o=(t[0],t[1]);(0,s.useEffect)((function(){o(!0)}),[]);var i=(0,c.G)().isDarkTheme,l=n.theme||u,h=n.darkTheme||l,m=i?h:l,y=e.lang,x=void 0===y?"yaml":y,f=e.snippet;return(0,a.jsx)(d.f4,{theme:m,code:f,language:x,children:function(e){var n=e.className,t=e.style,s=e.tokens,o=e.getLineProps,r=e.getTokenProps;return(0,a.jsx)("pre",{className:n+" "+p.codeSnippet,style:t,children:s.map((function(e,n){return(0,a.jsx)("div",Object.assign({},o({line:e,key:n}),{children:e.map((function(e,n){return(0,a.jsx)("span",Object.assign({},r({token:e,key:n})))}))}))}))})}})}function m(e){var n=e.to;return(0,a.jsx)(i.A,{to:(0,o.A)(n),children:e.children})}function y(e){var n=(0,r.A)(),t=e.type,s=e.hash,o=e.display,i=n.siteConfig.customFields.mongooseDocsUrl+"/"+function(e){switch(e){case"schema":return"guide";case"schemaType":return"SchemaTypes";case"connection":return"Connections";case"model":return"Models";case"document":return"Documents";case"subDocument":return"subdocs";case"query":return"Queries";case"validation":return"Validation";case"middleware":return"Middleware";case"populate":return"Populate";case"discriminator":return"Discriminators";case"plugins":return"Plugins"}throw new Error("Unknown link segment type "+e)}(t).toLowerCase()+".html"+(s?"#"+s:"");return(0,a.jsx)("a",{href:i,target:"_blank",children:e.children||o||s||""})}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(6540);const o={},r=s.createContext(o);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);