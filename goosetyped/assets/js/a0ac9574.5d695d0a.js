(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{194:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return s})),t.d(n,"metadata",(function(){return i})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return u}));var a=t(3),o=t(8),r=(t(0),t(277)),c=t(284),s={id:"local-column",title:"Local Columns",sidebar_label:"5. Local Columns"},i={unversionedId:"advanced/local-column",id:"advanced/local-column",isDocsHomePage:!1,title:"Local Columns",description:"Up to this point we've only used class properties which we're decorated with @GtColumn.",source:"@site/docs/advanced/local-column.md",slug:"/advanced/local-column",permalink:"/node/goosetyped/docs/advanced/local-column",editUrl:"https://github.com/pebula/node/tree/main/apps/docs/goosetyped/docs/docs/advanced/local-column.md",version:"current",sidebar_label:"5. Local Columns",sidebar:"someSidebar",previous:{title:"Query Methods / Helpers",permalink:"/node/goosetyped/docs/advanced/query-methods"},next:{title:"Plugins",permalink:"/node/goosetyped/docs/advanced/plugins"}},l=[{value:"Sub Documents &amp; Embedded Documents",id:"sub-documents--embedded-documents",children:[]}],d={toc:l};function u(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},d,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Up to this point we've only used class properties which we're decorated with ",Object(r.b)("inlineCode",{parentName:"p"},"@GtColumn"),"."),Object(r.b)("p",null,"What will happen if we use non-column properties, can we use initializers?"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-typescript"},"import { GtDocument, GtModel, GtColumn } from '@pebula/goosetyped';\n\n@GtDocument()\nexport class Person extends GtModel() {\n  @GtColumn() name: string;\n  @GtColumn() age: number;\n\n  myLocalNumber: number = 99;\n  private myPrivateString = 'STRING!';\n}\n")),Object(r.b)("p",null,"Well, nothing special actually, it will just work, the instance will reflect these values but when saving the model\nthey will not update the database."),Object(r.b)("p",null,"When we do"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-typescript"},"const person = await Person.create({});\nconsole.log(person.myLocalNumber) // Prints 99\n")),Object(r.b)("p",null,"The framework will create a new instance for us, which will run through the constructor and initialize the values."),Object(r.b)("p",null,"Because we use native JS classes as our models they play along nicely!"),Object(r.b)("h2",{id:"sub-documents--embedded-documents"},"Sub Documents & Embedded Documents"),Object(r.b)(c.a,{type:"subDocument",mdxType:"MongooseDocsLink"},"SubDocuments")," are a bit different.",Object(r.b)("p",null,"When mongoose detects a column that is an embedded document it will treat it differently. It will\nnot use the class defined for it but instead will use a new class it creates for every column that is an embedded document which mimic the behavior of the original class."),Object(r.b)("p",null,"This how mongoose works for all embedded documents, including simple nested schema, complex discriminators and Array/Map of them."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-ts"},"import {\n  GtSubDocument,\n  GtResource,\n  GtDocument,\n  GtModel,\n  GtColumn,\n} from '@pebula/goosetyped';\n\n@GtSubDocument({ noId: true })\nexport class Address extends GtResource() {\n  @GtColumn()\n  street: string;\n\n  @GtColumn()\n  country: string;\n}\n\n@GtDocument()\nexport class Customer extends GtModel() {\n  @GtColumn()\n  name: string;\n\n  @GtColumn()\n  age: number;\n\n  @GtColumn()\n  address: Address; // <- Embedded Column\n}\n")),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},Object(r.b)("inlineCode",{parentName:"p"},"Address")," is an embedded column, not because it is wrapped by ",Object(r.b)("inlineCode",{parentName:"p"},"@GtSubDocument"),", it is an embedded column because it is nested within the root document"))),Object(r.b)("p",null,"In the example above, ",Object(r.b)("inlineCode",{parentName:"p"},"Customer.address")," will point to class ",Object(r.b)("inlineCode",{parentName:"p"},"SingleNested")," but it does not really matter because ",Object(r.b)("strong",{parentName:"p"},"GooseTyped")," takes care to synchronize and run what's needed."),Object(r.b)("p",null,"It will make sure that the original constructor ran and will also adapt the class to support instanceOf so the expression ",Object(r.b)("inlineCode",{parentName:"p"},"person.address instanceOf Address")," is ",Object(r.b)("strong",{parentName:"p"},"true"),"."),Object(r.b)("p",null,"The only issue we have is with local columns / properties.\n",Object(r.b)("strong",{parentName:"p"},"GooseTyped")," maintains a sync between the original class and the new mongoose class but it can't track the members which are not declared."),Object(r.b)("p",null,"To solve this issue you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"@GtLocalProp")," decorator which will make the property so it will be synced."),Object(r.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Using local column or private properties in general is not recommended, avoid them to prevent unfortunate bugs and errors."))))}u.isMDXComponent=!0},277:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return b}));var a=t(0),o=t.n(a);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=o.a.createContext({}),d=function(e){var n=o.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},u=function(e){var n=d(e.components);return o.a.createElement(l.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},p=o.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=d(t),p=a,b=u["".concat(c,".").concat(p)]||u[p]||m[p]||r;return t?o.a.createElement(b,s(s({ref:n},l),{},{components:t})):o.a.createElement(b,s({ref:n},l))}));function b(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,c=new Array(r);c[0]=p;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s.mdxType="string"==typeof e?e:a,c[1]=s;for(var l=2;l<r;l++)c[l]=t[l];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},284:function(e,n,t){"use strict";var a=t(0),o=t.n(a),r=t(16);t(57);n.a=function(e){var n=Object(r.default)(),t=e.type,a=e.hash,c=e.display,s=n.siteConfig.customFields.mongooseDocsUrl+"/"+function(e){switch(e){case"schema":return"guide";case"schemaType":return"SchemaTypes";case"connection":return"Connections";case"model":return"Models";case"document":return"Documents";case"subDocument":return"subdocs";case"query":return"Queries";case"validation":return"Validation";case"middleware":return"Middleware";case"populate":return"Populate";case"discriminator":return"Discriminators";case"plugins":return"Plugins"}throw new Error("Unknown link segment type "+e)}(t).toLowerCase()+".html"+(a?"#"+a:"");return o.a.createElement("a",{href:s,target:"_blank"},e.children||c||a||"")}}}]);